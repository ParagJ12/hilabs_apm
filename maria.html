<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HiLabs — Regional Coverage Dashboard (Maria Santos)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root{
      --hi-blue:#2c6aef; --accent:#2c6aef; --panel-bg:#ffffff; --muted:#6b7280; --bg:#f8f9fa;
    }
    body { font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:var(--bg); color:#0b1220; margin:0; }
    .container-fluid { max-width:1400px; margin:auto; padding:16px; }
    .header { background:var(--hi-blue); color:#fff; border-radius:10px; padding:14px 18px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 6px 18px rgba(44,106,239,0.12); margin-bottom:14px; z-index:1000; position:relative;}
    .header h4{ margin:0; font-weight:700; }
    .header-sub{ font-size:13px; color:rgba(255,255,255,0.92); margin-top:6px; }
    .kpi-row{ display:flex; gap:10px; align-items:center; }
    .kpi{ background:var(--panel-bg); border-radius:8px; padding:10px 12px; min-width:140px; text-align:center; box-shadow:0 2px 6px rgba(2,6,23,0.06); border-left:4px solid var(--accent); }
    .kpi .title{ font-size:12px; color:var(--muted); font-weight:600; }
    .kpi .val{ font-weight:700; font-size:18px; margin-top:6px; }

    .panel { background:var(--panel-bg); border-radius:10px; padding:14px; border-left:4px solid var(--accent); box-shadow:0 4px 10px rgba(2,6,23,0.04); }
    .panel h6{ margin-top:0; font-weight:700; font-size:16px; border-bottom:2px solid var(--accent); padding-bottom:8px; margin-bottom:12px; }
    .small-muted{ color:var(--muted); font-size:13px; }

    /* map */
    #map { height:360px; border-radius:8px; border:1px solid #e6edf8; position:relative; }
    .map-legend{ position:absolute; right:14px; top:14px; background:rgba(255,255,255,0.98); padding:8px 10px; border-radius:8px; border-left:4px solid var(--accent); box-shadow:0 6px 18px rgba(2,6,23,0.06); font-size:13px; z-index:500; min-width:200px; }
    .legend-row{ display:flex; gap:8px; align-items:center; margin-bottom:6px; }
    .sw{ width:14px;height:14px;border-radius:3px; display:inline-block; }

    .scroll-table{ max-height:260px; overflow:auto; padding-right:6px; }
    .table thead th{ background:var(--accent); color:#fff; position:sticky; top:0; z-index:2; }
    #quality-plot{ height:220px; width:100%; }

    /* layout helpers */
    .panel-eq{ min-height:260px; display:flex; flex-direction:column; }
    .controls-row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .btn-compact{ padding:6px 10px; font-size:13px; }

    .footer{ text-align:center; color:var(--muted); margin-top:12px; font-size:13px; }

    @media (max-width:1100px){
      #map{ height:300px; }
      .panel-eq{ min-height:220px; }
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="header">
      <div>
        <h4>HiLabs — HiView: Regional Coverage Intelligence</h4>
        <div class="header-sub">User: Maria Santos — Regional Network Manager (Mid-Atlantic)</div>
      </div>
      <div class="kpi-row">
        <div class="kpi"><div class="title">Coverage Adequacy</div><div class="val" id="kpi-adequacy">94%</div><div class="small-muted">Target 95%</div></div>
        <div class="kpi"><div class="title">Total Providers</div><div class="val" id="kpi-providers">1,245</div><div class="small-muted">In-region</div></div>
        <div class="kpi"><div class="title">Potential Savings</div><div class="val" id="kpi-savings">$3.4M</div><div class="small-muted">Negotiation targets</div></div>
      </div>
    </div>

    <!-- Top Controls -->
    <div class="row g-3 mb-2 align-items-start">
      <div class="col-lg-8">
        <div class="panel">
          <div class="controls-row mb-2">
            <div>
              <label class="small-muted">Type</label>
              <select id="type-filter" class="form-select form-select-sm">
                <option>Health</option><option>Auto</option><option>Life</option>
              </select>
            </div>
            <div>
              <label class="small-muted">Coverage Level</label>
              <select id="coverage-filter" class="form-select form-select-sm">
                <option>Basic</option><option selected>Standard</option><option>Premium</option><option>Comprehensive</option>
              </select>
            </div>
            <div>
              <label class="small-muted">Date Range</label>
              <select id="date-range" class="form-select form-select-sm">
                <option>Last 30 days</option><option selected>Last Quarter</option><option>Last 12 months</option><option>Custom</option>
              </select>
            </div>
            <div style="align-self:end;">
              <button class="btn btn-compact btn-primary" id="refresh-btn">Refresh</button>
              <button class="btn btn-compact btn-outline-secondary" id="export-btn">Export</button>
            </div>
          </div>

          <div style="display:flex; gap:10px; align-items:stretch;">
            <div style="flex:1;">
              <h6 class="mb-2" style="margin-bottom:6px;">Current Coverage Status — Mid-Atlantic</h6>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <div style="flex:1; min-width:150px;">
                  <div class="small-muted">Total Active Providers</div><div style="font-weight:700; font-size:16px" id="active-providers">1,245</div>
                </div>
                <div style="flex:1; min-width:150px;">
                  <div class="small-muted">Average Member Access Distance</div><div style="font-weight:700; font-size:16px" id="avg-dist">12.5 miles</div>
                </div>
                <div style="flex:1; min-width:150px;">
                  <div class="small-muted">Counties Below Threshold</div><div style="font-weight:700; font-size:16px" id="below-counties">3</div>
                </div>
                <div style="flex:1; min-width:150px;">
                  <div class="small-muted">Utilization</div><div style="font-weight:700; font-size:16px" id="util">89%</div>
                </div>
              </div>
            </div>

            <div style="width:360px;">
              <div class="small-muted">Compliance</div>
              <div style="display:flex; gap:8px; margin-top:8px;">
                <div style="flex:1; background:#ecfdf5; border-radius:8px; padding:8px;"><div style="font-weight:700; color:#059669;">Green</div><div class="small-muted">Compliant</div></div>
                <div style="flex:1; background:#fffbeb; border-radius:8px; padding:8px;"><div style="font-weight:700; color:#b45309;">Yellow</div><div class="small-muted">At Risk</div></div>
                <div style="flex:1; background:#fff1f2; border-radius:8px; padding:8px;"><div style="font-weight:700; color:#b91c1c;">Red</div><div class="small-muted">Non-compliant</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Map & Legend -->
      <div class="col-lg-4">
        <div class="panel panel-eq">
          <h6>Regional Adequacy Map</h6>
          <div id="map"></div>
        </div>
      </div>
    </div>

    <!-- Provider table & goals -->
    <div class="row g-3">
      <div class="col-lg-7">
        <div class="panel panel-eq">
          <h6>Provider Network Details</h6>
          <div style="display:flex; gap:8px; margin-bottom:8px; align-items:center;">
            <input id="provider-search" class="form-control form-control-sm" placeholder="Search provider or county" style="flex:1;" />
            <select id="specialty-filter" class="form-select form-select-sm" style="width:180px;">
              <option>All specialties</option>
              <option>Cardiology</option><option>Orthopedics</option><option>Primary Care</option><option>Radiology</option>
            </select>
            <button class="btn btn-sm btn-outline-primary" id="filter-btn">Apply</button>
          </div>
          <div class="scroll-table">
            <table class="table table-sm">
              <thead><tr><th>Provider</th><th>Specialty</th><th>County</th><th>Avg Rate vs Market</th><th>Member Load</th><th>Risk</th></tr></thead>
              <tbody id="provider-tbody"></tbody>
            </table>
          </div>
          <div style="margin-top:10px; font-size:13px; color:var(--muted);">Tip: click a provider row to view negotiation brief (demo).</div>
        </div>
      </div>

      <div class="col-lg-5">
        <div class="panel panel-eq">
          <h6>Goals & Compliance</h6>
          <div style="margin-bottom:10px;">
            <div class="small-muted">Adequacy Target</div>
            <div style="font-weight:700; font-size:18px">95% by Q4</div>
            <div class="progress mb-3"><div class="progress-bar" style="width:94%">94%</div></div>
          </div>

          <div style="margin-bottom:12px;">
            <div class="small-muted">Counties Needing Action</div>
            <ul>
              <li>Allegheny County — Add 2 PCPs</li>
              <li>Somerset County — Recruit 1 Cardiologist</li>
              <li>Harford County — Telehealth expansion</li>
            </ul>
          </div>

          <h6 style="margin-top:8px;">Cost Management</h6>
          <div style="display:flex; gap:8px;">
            <div style="flex:1;">
              <div class="small-muted">Regional Spend (Q3)</div><div style="font-weight:700;">$82.4M</div>
              <div class="small-muted">Rate Variance vs Market</div><div style="font-weight:700;">+5.8%</div>
            </div>
            <div style="flex:1;">
              <div class="small-muted">Potential Savings</div><div style="font-weight:700;">$3.4M</div>
              <div class="small-muted">Claim Denial Rate</div><div style="font-weight:700;">7.3%</div>
            </div>
          </div>

          <div style="margin-top:12px;">
            <button class="btn btn-primary btn-sm" id="run-audit">Run Adequacy Audit</button>
            <button class="btn btn-outline-secondary btn-sm" id="download-report">Download Gap Report</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Trend chart row -->
    <div class="row g-3 mt-3">
      <div class="col-lg-8">
        <div class="panel">
          <h6>Budget vs Actual & Rate Trends</h6>
          <div id="trend-plot" style="height:320px;"></div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="panel">
          <h6>Quick Actions</h6>
          <div style="display:flex; flex-direction:column; gap:8px;">
            <button class="btn btn-outline-primary">Create Recruitment Request</button>
            <button class="btn btn-outline-warning">Flag Provider for Re-contract</button>
            <button class="btn btn-outline-success">Push Telehealth Expansion</button>
            <div style="font-size:13px; color:var(--muted);">Actions are mock/stubbed for the demo.</div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">Prototype (synthetic data) — HiLabs 2025 • No PHI • Last updated: Nov 2025</div>
  </div>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.24.0/plotly.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Synthetic regional adequacy data (counties)
    const counties = [
      {id:'Allegheny', lat:40.44, lon:-79.98, adequacy:87, pop:1250, suggest:"Add 2 PCPs"},
      {id:'Somerset', lat:40.02, lon:-79.08, adequacy:82, pop:45, suggest:"Recruit 1 Cardiologist"},
      {id:'Harford', lat:39.55, lon:-76.34, adequacy:92, pop:260, suggest:"Telehealth expansion"},
      {id:'Cambria', lat:40.49, lon:-78.77, adequacy:96, pop:130, suggest:"OK"},
      {id:'York', lat:39.96, lon:-76.73, adequacy:95, pop:450, suggest:"OK"},
      {id:'Lancaster', lat:40.04, lon:-76.30, adequacy:90, pop:400, suggest:"Monitor"}
    ];

    // Provider list (synthetic)
    let providers = [
      {name:"Allegheny Cardio Clinic", spec:"Cardiology", county:"Allegheny", diff:+12, load:420, risk:"High"},
      {name:"Somerset Ortho Center", spec:"Orthopedics", county:"Somerset", diff:+9, load:120, risk:"Moderate"},
      {name:"Harford Primary Care", spec:"Primary Care", county:"Harford", diff:+4, load:210, risk:"Low"},
      {name:"Cambria Radiology", spec:"Radiology", county:"Cambria", diff:+2, load:95, risk:"Low"},
      {name:"York Family Practice", spec:"Primary Care", county:"York", diff:-1, load:320, risk:"Low"},
      {name:"Lancaster Surgical", spec:"General Surgery", county:"Lancaster", diff:+7, load:150, risk:"Moderate"}
    ];

    // setup map
    const map = L.map('map', {zoomControl:true, scrollWheelZoom:false}).setView([40.0, -78.0], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution:'© OpenStreetMap' }).addTo(map);

    // legend inside map
    const legendDiv = document.createElement('div');
    legendDiv.className = 'map-legend';
    legendDiv.innerHTML = `<div style="font-weight:700; margin-bottom:6px;">Coverage Legend</div>
      <div class="legend-row"><span class="sw" style="background:#10b981"></span><div>Green: ≥95% (Compliant)</div></div>
      <div class="legend-row"><span class="sw" style="background:#f59e0b"></span><div>Yellow: 90–95% (At Risk)</div></div>
      <div class="legend-row"><span class="sw" style="background:#ef4444"></span><div>Red: &lt;90% (Non-compliant)</div></div>`;
    document.getElementById('map').appendChild(legendDiv);

    // markers
    const markers = [];
    function refreshCountyMarkers(){
      markers.forEach(m => map.removeLayer(m));
      markers.length = 0;
      counties.forEach(c=>{
        const color = c.adequacy >=95 ? '#10b981' : (c.adequacy >=90 ? '#f59e0b' : '#ef4444');
        const m = L.circleMarker([c.lat, c.lon], {radius:12, fillColor:color, color:'#0b1220', weight:1.2, fillOpacity:0.95}).addTo(map);
        m.bindTooltip(`<strong>${c.id}</strong><br>Adequacy: ${c.adequacy}%<br>Population: ${c.pop}k<br>Action: ${c.suggest}`);
        m.on('click', ()=> {
          // scroll to provider table and filter providers of county
          document.getElementById('provider-search').value = c.id;
          applyProviderFilter();
          document.getElementById('provider-tbody').scrollIntoView({behavior:'smooth'});
        });
        markers.push(m);
      });
    }
    refreshCountyMarkers();

    // render provider table
    function renderProviders(list){
      const tbody = document.getElementById('provider-tbody');
      tbody.innerHTML = '';
      list.forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td style="cursor:pointer; font-weight:600;">${p.name}</td>
          <td>${p.spec}</td><td>${p.county}</td><td>${p.diff>0? '+'+p.diff+'%': p.diff+'%'}</td>
          <td>${p.load}</td><td>${p.risk}</td>`;
        tr.addEventListener('click', ()=> openNegotiationBrief(p));
        tbody.appendChild(tr);
      });
    }
    renderProviders(providers);

    function applyProviderFilter(){
      const search = document.getElementById('provider-search').value.trim().toLowerCase();
      const spec = document.getElementById('specialty-filter').value;
      const filtered = providers.filter(p => {
        const okSearch = !search || p.name.toLowerCase().includes(search) || p.county.toLowerCase().includes(search);
        const okSpec = spec === "All specialties" || p.spec === spec;
        return okSearch && okSpec;
      });
      renderProviders(filtered);
    }
    document.getElementById('filter-btn').addEventListener('click', applyProviderFilter);

    // negotiation brief stub
    function openNegotiationBrief(p){
      alert(`${p.name}\nSpecialty: ${p.spec}\nCounty: ${p.county}\nAvg rate diff: ${p.diff}%\nMember load: ${p.load}\nRisk: ${p.risk}\n\nRecommendation: Consider re-contract negotiation. Estimated regional impact: $${(p.diff*0.05).toFixed(2)}M`);
    }

    // Trend plot: budget vs actual and rate trend (Plotly)
    function renderTrend(){
      const months = ['Mar','Apr','May','Jun','Jul','Aug','Sep'];
      const budget = [12,11.5,11.8,12.2,12,11.9,12.5];
      const actual = [12.4,11.8,12.5,13.2,12.6,12.3,12.9];
      const rate = [4.2,4.6,5.0,5.1,5.4,5.6,5.8];

      const trace1 = {x:months, y:budget, name:'Budget ($M)', type:'bar', marker:{color:'#c7d9ff'}};
      const trace2 = {x:months, y:actual, name:'Actual ($M)', type:'bar', marker:{color:'#2c6aef'}};
      const trace3 = {x:months, y:rate, name:'Rate Variance (%)', yaxis:'y2', mode:'lines+markers', marker:{color:'#f59e0b'}, line:{width:3}};
      const layout = {
        margin:{t:30,l:40,r:40,b:50},
        yaxis:{title:'$M'},
        yaxis2:{title:'Rate %', overlaying:'y', side:'right'},
        legend:{orientation:'h', y:-0.18}
      };
      Plotly.newPlot('trend-plot',[trace1,trace2,trace3],layout,{displayModeBar:false, responsive:true});
    }
    renderTrend();

    // initial KPI fill function
    function refreshKPIs(){
      const adequacy = Math.round((counties.reduce((s,c)=>s+c.adequacy,0)/counties.length));
      document.getElementById('kpi-adequacy').innerText = adequacy + '%';
      document.getElementById('kpi-providers').innerText = '1,245';
      document.getElementById('kpi-savings').innerText = '$3.4M';
      document.getElementById('active-providers').innerText = '1,245';
      document.getElementById('avg-dist').innerText = '12.5 miles';
      document.getElementById('below-counties').innerText = counties.filter(c=>c.adequacy<90).length;
      document.getElementById('util').innerText = '89%';
    }
    refreshKPIs();

    // controls
    document.getElementById('refresh-btn').addEventListener('click', ()=>{
      // for demo: randomize one county adequacy to show dynamic behavior
      counties.forEach(c=> {
        c.adequacy = Math.max(78, Math.min(98, c.adequacy + (Math.random()*5-2)));
      });
      refreshCountyMarkers();
      refreshKPIs();
      renderProviders(providers);
    });

    document.getElementById('export-btn').addEventListener('click', ()=>{
      alert('Export stub -> In product: allow PDF/XLS/PNG export of current view.');
    });

    document.getElementById('run-audit').addEventListener('click', ()=>{
      alert('Adequacy audit run (demo). See recommended actions in Goals section.');
    });
    document.getElementById('download-report').addEventListener('click', ()=>{
      alert('Downloading Gap Report (demo).');
    });

    // search apply on enter
    document.getElementById('provider-search').addEventListener('keydown', e=> { if(e.key==='Enter') applyProviderFilter(); });

    // basic responsive redraw for Plotly on resize
    window.addEventListener('resize', ()=> { try{ Plotly.Plots.resize(document.getElementById('trend-plot')); }catch(e){} });
  </script>
</body>
</html>
