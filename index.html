<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HiLabs — HiView Dashboard (Jenifer Hayes)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --hi-blue: #2c6aef;
      --hi-dark-blue: #1e4db7;
      --hi-bg: #f5f7fa;
      --panel-bg: #ffffff;
      --muted: #6b7280;
      --accent: #2c6aef;
      --border-color: #e5e7eb;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text-primary: #111827;
      --text-secondary: #6b7280;
    }
    
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; padding: 0; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--hi-bg); 
      color: var(--text-primary); 
      line-height: 1.6;
      font-size: 14px;
    }
    
    .container-fluid { 
      padding: 32px; 
      max-width: 1600px; 
      margin: 0 auto; 
    }

    /* ===================== HEADER ===================== */
    .header { 
      background: linear-gradient(135deg, var(--hi-blue) 0%, var(--hi-dark-blue) 100%);
      color: #fff; 
      border-radius: 16px; 
      padding: 28px 36px;
      margin-bottom: 32px;
      box-shadow: 0 8px 24px rgba(44, 106, 239, 0.2);
    }
    
    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
      flex-wrap: wrap;
    }
    
    .header-left h1 { 
      margin: 0; 
      font-weight: 700; 
      font-size: 32px;
      letter-spacing: -0.5px;
    }
    
    .header-subtitle { 
      font-size: 15px; 
      color: rgba(255,255,255,0.92); 
      margin-top: 6px;
      font-weight: 500;
    }

    /* KPI Cards */
    .kpi-row { 
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }
    
    .kpi-card { 
      background: rgba(255,255,255,0.18);
      backdrop-filter: blur(12px);
      border-radius: 12px; 
      padding: 20px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.25);
      transition: all 0.3s ease;
    }
    
    .kpi-card:hover {
      background: rgba(255,255,255,0.28);
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    
    .kpi-label { 
      font-size: 12px; 
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: rgba(255,255,255,0.88);
      font-weight: 600;
      margin-bottom: 10px;
    }
    
    .kpi-value { 
      font-weight: 700; 
      font-size: 28px;
      color: #fff;
      margin-bottom: 6px;
      line-height: 1;
    }
    
    .kpi-meta { 
      font-size: 12px; 
      color: rgba(255,255,255,0.75);
      font-weight: 500;
    }

    /* ===================== PANELS ===================== */
    .panel { 
      background: var(--panel-bg); 
      border-radius: 16px; 
      padding: 28px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid var(--border-color);
      height: 100%;
      display: flex;
      flex-direction: column;
      transition: box-shadow 0.3s ease;
    }
    
    .panel:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    
    .panel-header { 
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 18px;
      border-bottom: 2px solid var(--border-color);
    }
    
    .panel-title { 
      margin: 0; 
      font-weight: 700; 
      font-size: 19px;
      color: var(--text-primary);
      letter-spacing: -0.3px;
    }
    
    .panel-badge {
      font-size: 13px;
      padding: 6px 14px;
      border-radius: 8px;
      background: #f3f4f6;
      color: var(--text-secondary);
      font-weight: 600;
    }

    /* ===================== HEATMAP STYLES ===================== */
    .heatmap-container {
      position: relative;
      background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
      border-radius: 12px;
      padding: 24px;
      flex: 1;
      min-height: 400px;
    }
    
    .heatmap-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .heatmap-cell {
      background: white;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid #e5e7eb;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    }
    
    .heatmap-cell::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: currentColor;
      transition: height 0.3s ease;
    }
    
    .heatmap-cell:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    
    .heatmap-cell:hover::before {
      height: 8px;
    }
    
    .heatmap-cell.severity-low { 
      border-color: var(--success);
      color: var(--success);
    }
    
    .heatmap-cell.severity-medium { 
      border-color: var(--warning);
      color: var(--warning);
    }
    
    .heatmap-cell.severity-high { 
      border-color: var(--danger);
      color: var(--danger);
    }
    
    .heatmap-state {
      font-weight: 700;
      font-size: 17px;
      color: var(--text-primary);
      margin-bottom: 6px;
      letter-spacing: -0.2px;
    }
    
    .heatmap-value {
      font-size: 32px;
      font-weight: 700;
      margin: 12px 0;
      line-height: 1;
    }
    
    .heatmap-label {
      font-size: 11px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.6px;
      font-weight: 600;
    }
    
    .heatmap-details {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #e5e7eb;
      line-height: 1.5;
    }
    
    .heatmap-legend {
      display: flex;
      gap: 32px;
      justify-content: center;
      align-items: center;
      padding: 18px;
      background: white;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
    }
    
    .legend-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 3px solid currentColor;
      flex-shrink: 0;
    }

    /* ===================== FORMS ===================== */
    .form-label {
      font-weight: 600;
      font-size: 13px;
      color: var(--text-primary);
      margin-bottom: 10px;
      display: block;
    }
    
    .form-select, .form-control {
      border-radius: 10px;
      border: 1.5px solid var(--border-color);
      padding: 12px 14px;
      font-size: 14px;
      transition: all 0.2s ease;
      background: white;
    }
    
    .form-select:focus, .form-control:focus {
      border-color: var(--hi-blue);
      box-shadow: 0 0 0 4px rgba(44, 106, 239, 0.1);
      outline: none;
    }

    /* ===================== METRICS GRID ===================== */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .metric-item {
      padding: 20px;
      background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
      border-radius: 12px;
      border-left: 4px solid var(--hi-blue);
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
      transition: all 0.3s ease;
    }
    
    .metric-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    }
    
    .metric-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.6px;
      margin-bottom: 8px;
    }
    
    .metric-value {
      font-size: 26px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
      line-height: 1.2;
    }
    
    .metric-trend {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* ===================== ALERTS & SUGGESTIONS ===================== */
    .ai-pane {
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex: 1;
    }
    
    .ai-suggestion {
      border-left: 4px solid var(--danger);
      padding: 16px;
      border-radius: 10px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      transition: all 0.3s ease;
    }
    
    .ai-suggestion:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateX(4px);
    }
    
    .ai-suggestion-title {
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 8px;
      color: var(--text-primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .ai-suggestion-body {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    
    .confidence-badge {
      font-size: 11px;
      padding: 4px 10px;
      background: #f3f4f6;
      border-radius: 6px;
      color: var(--text-secondary);
      font-weight: 600;
    }

    /* ===================== TABLES ===================== */
    .table-wrapper {
      flex: 1;
      overflow: auto;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      max-height: 320px;
    }
    
    .table {
      margin: 0;
      font-size: 13px;
    }
    
    .table thead th {
      background: #f9fafb;
      color: var(--text-primary);
      font-weight: 700;
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.6px;
      padding: 14px 16px;
      border-bottom: 2px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .table tbody td {
      padding: 14px 16px;
      color: var(--text-primary);
      border-bottom: 1px solid #f3f4f6;
      font-size: 13px;
    }
    
    .table tbody tr:hover {
      background: #f9fafb;
    }

    /* ===================== CHARTS ===================== */
    .chart-container {
      flex: 1;
      min-height: 320px;
      position: relative;
      background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
      border-radius: 12px;
      padding: 16px;
    }

    /* ===================== SCENARIO PLANNER ===================== */
    .scenario-wrapper {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 28px;
      padding: 28px;
      background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
      border-radius: 16px;
      border: 1px solid var(--border-color);
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    
    .scenario-controls {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .scenario-title {
      font-weight: 700;
      font-size: 17px;
      color: var(--text-primary);
      margin-bottom: 12px;
      letter-spacing: -0.2px;
    }
    
    .slider-value {
      color: var(--hi-blue);
      font-weight: 700;
      font-size: 24px;
      text-align: center;
      padding: 12px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
      border: 2px solid var(--border-color);
    }
    
    .scenario-results {
      background: white;
      border-radius: 12px;
      padding: 24px;
      border: 1px solid var(--border-color);
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
      overflow: auto;
    }

    /* ===================== PROGRESS BARS ===================== */
    .progress {
      height: 12px;
      border-radius: 8px;
      background: #e5e7eb;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-bar {
      background: linear-gradient(90deg, var(--hi-blue) 0%, var(--hi-dark-blue) 100%);
      height: 100%;
      border-radius: 8px;
      transition: width 0.5s ease;
    }

    /* ===================== BUTTONS ===================== */
    .btn {
      border-radius: 10px;
      padding: 10px 20px;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
      border: none;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--hi-blue) 0%, var(--hi-dark-blue) 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(44, 106, 239, 0.3);
    }
    
    .btn-outline-primary {
      border: 2px solid var(--hi-blue);
      color: var(--hi-blue);
      background: white;
    }
    
    .btn-outline-primary:hover {
      background: var(--hi-blue);
      color: white;
    }
    
    .btn-outline-success {
      border: 2px solid var(--success);
      color: var(--success);
      background: white;
    }
    
    .btn-outline-success:hover {
      background: var(--success);
      color: white;
    }

    /* ===================== SPACING & LAYOUT ===================== */
    .row {
      --bs-gutter-x: 24px;
      --bs-gutter-y: 24px;
    }
    
    .mb-section {
      margin-bottom: 32px;
    }

    /* ===================== FOOTER ===================== */
    .footer {
      text-align: center;
      color: var(--text-secondary);
      margin-top: 48px;
      padding-top: 32px;
      border-top: 2px solid var(--border-color);
      font-size: 13px;
      font-weight: 500;
    }

    /* ===================== RESPONSIVE ===================== */
    @media (max-width: 1200px) {
      .scenario-wrapper {
        grid-template-columns: 1fr;
      }
      
      .heatmap-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      }
      
      .metrics-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }
    }
    
    @media (max-width: 768px) {
      .container-fluid {
        padding: 20px;
      }
      
      .header {
        padding: 24px;
      }
      
      .panel {
        padding: 20px;
      }
      
      .kpi-value {
        font-size: 24px;
      }
      
      .kpi-row {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
    }

    /* ===================== INPUT GROUP ===================== */
    .input-group {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }
    
    .input-group .form-control {
      border-radius: 10px 0 0 10px;
      border-right: none;
    }
    
    .input-group .btn {
      border-radius: 0 10px 10px 0;
    }

    /* ===================== ALERT STYLES ===================== */
    .alert {
      border-radius: 12px;
      padding: 16px 20px;
      border-left: 4px solid;
      font-size: 13px;
      line-height: 1.6;
      margin-bottom: 0;
    }
    
    .alert-info {
      background: #eff6ff;
      border-color: #3b82f6;
      color: #1e40af;
    }
    
    .alert-danger {
      background: #fef2f2;
      border-color: var(--danger);
      color: #991b1b;
    }
    
    .alert-warning {
      background: #fffbeb;
      border-color: var(--warning);
      color: #92400e;
    }
    
    .alert-success {
      background: #f0fdf4;
      border-color: var(--success);
      color: #065f46;
    }

    /* Snapshot Details */
    .snapshot-detail {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #f3f4f6;
    }
    
    .snapshot-detail:last-child {
      border-bottom: none;
    }
    
    .snapshot-detail strong {
      color: var(--text-primary);
      font-weight: 600;
    }
    
    .snapshot-detail span {
      color: var(--text-secondary);
      font-weight: 600;
    }

    /* Action Buttons Container */
    .ai-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    hr {
      border: none;
      border-top: 1px solid var(--border-color);
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <!-- ===================== HEADER ===================== -->
    <div class="header">
      <div class="header-content">
        <div class="header-left">
          <h1>HiLabs | Risk & Rate Intelligence Platform</h1>
          <div class="header-subtitle">User: Jenifer Hayes — VP, Network Strategy</div>
        </div>
      </div>
      
      <div class="kpi-row">
        <div class="kpi-card">
          <div class="kpi-label">Patient Satisfaction</div>
          <div class="kpi-value">81<span style="font-size:18px">/100</span></div>
          <div class="kpi-meta">Confidence 82%</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Provider ROI</div>
          <div class="kpi-value">112.6%</div>
          <div class="kpi-meta">Confidence 88%</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Accessibility</div>
          <div class="kpi-value">58<span style="font-size:18px">/100</span></div>
          <div class="kpi-meta">Confidence 75%</div>
        </div>
      </div>
    </div>

    <!-- ===================== TOP ROW ===================== -->
    <div class="row mb-section">
      <!-- Network Snapshot -->
      <div class="col-lg-3">
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Network Snapshot</h2>
          </div>
          
          <label class="form-label">Network Name</label>
          <select id="network-name" class="form-select form-select-sm mb-3">
            <option value="PacificCare Integrated Health">PacificCare Integrated Health</option>
            <option value="Midwest Regional Medical">Midwest Regional Medical Alliance</option>
            <option value="Tri-State Wellness">Tri-State Wellness Group</option>
            <option value="Northeast Community Health">Northeast Community Health Partners</option>
            <option value="Southern Cross Healthcare">Southern Cross Healthcare Network</option>
            <option value="Great Plains Care Connect">Great Plains Care Connect</option>
            <option value="Bayview Specialty Health" selected>Bayview Specialty Health System</option>
            <option value="Rocky Mountain Health">Rocky Mountain Health Collaborative</option>
          </select>

          <label class="form-label">Network Type</label>
          <select id="network-type" class="form-select form-select-sm mb-3">
            <option>Type-1: Primary Care Network</option>
            <option>Type-2: Specialty Care Network</option>
            <option selected>Type-3: Behavioral Health Network</option>
            <option>Type-4: Dental/Vision Network</option>
            <option>Type-5: Multi-Specialty Network</option>
            <option>Type-6: Accountable Care Organization</option>
            <option>Type-7: Managed Care Network (HMO/PPO)</option>
          </select>

          <label class="form-label">Coverage Area</label>
          <select id="coverage-area" class="form-select form-select-sm mb-3">
            <option value="Southwest">Southwest — AZ, NM, NV</option>
            <option value="New England">New England — MA, CT, RI, NH</option>
            <option value="Pacific Northwest">Pacific Northwest — WA, OR, CA</option>
            <option value="Great Lakes" selected>Great Lakes — IL, MI, OH</option>
            <option value="Southeast">Southeast — FL, GA, SC</option>
            <option value="Mountain States">Mountain States — CO, UT, ID</option>
          </select>

          <hr>
          
          <div class="snapshot-detail">
            <strong>Providers:</strong>
            <span id="provider-count">480</span>
          </div>
          <div class="snapshot-detail">
            <strong>Savings Opportunity:</strong>
            <span id="savings-opp">9 contracts (~$7.4M)</span>
          </div>
          <div class="snapshot-detail">
            <strong>Rate Score:</strong>
            <span id="rate-score">6.0 / 10</span>
          </div>
          <div class="snapshot-detail">
            <strong>Adequacy:</strong>
            <span id="adequacy">93%</span>
          </div>
        </div>
      </div>

      <!-- Key Metrics & Heatmap -->
      <div class="col-lg-6">
        <div class="panel mb-4">
          <div class="panel-header">
            <h2 class="panel-title">Key Metrics</h2>
          </div>
          <div class="metrics-grid">
            <div class="metric-item">
              <div class="metric-label">Total Network Spend</div>
              <div class="metric-value" id="total-spend">$150M</div>
              <div class="metric-trend">↓ Down 3% YoY</div>
            </div>
            <div class="metric-item">
              <div class="metric-label">Cost Leakage</div>
              <div class="metric-value" id="cost-leakage">$7.4M</div>
              <div class="metric-trend">From rate benchmarking</div>
            </div>
            <div class="metric-item">
              <div class="metric-label">Market Position</div>
              <div class="metric-value" id="market-position">+3.6%</div>
              <div class="metric-trend">Above median overpay</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Regional Risk Heatmap</h2>
            <span class="panel-badge">Interactive</span>
          </div>
          <div class="heatmap-container">
            <div class="heatmap-grid" id="heatmap-grid">
              <!-- Heatmap cells will be generated dynamically -->
            </div>
            <div class="heatmap-legend">
              <div class="legend-item">
                <span class="legend-dot" style="color: var(--danger)"></span>
                <span>High Risk (>10% overpay)</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot" style="color: var(--warning)"></span>
                <span>Medium Risk (5-10%)</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot" style="color: var(--success)"></span>
                <span>Low Risk (<5%)</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Automated Insights -->
      <div class="col-lg-3">
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Automated Insights</h2>
            <span class="panel-badge">AI-Powered</span>
          </div>

          <div id="ai-suggestions" class="ai-pane">
            <!-- AI suggestions will be injected here -->
          </div>

          <div style="margin-top: auto;">
            <hr>
            <div style="margin-bottom: 12px; font-size: 13px; color: var(--text-secondary); font-weight: 600;">
              Quick Actions:
            </div>
            <div class="ai-actions">
              <button id="export-suggestions" class="btn btn-sm btn-outline-primary">Export</button>
              <button id="run-scan" class="btn btn-sm btn-outline-success">Run Scan</button>
            </div>
            
            <hr>
            
            <label class="form-label">Ask AI</label>
            <div class="input-group input-group-sm">
              <input id="ai-question" class="form-control" placeholder="e.g., Which specialty to target?" />
              <button id="ai-ask" class="btn btn-primary">Ask</button>
            </div>
            <div id="ai-answer" style="margin-top: 12px; font-size: 13px; color: var(--text-primary); line-height: 1.6;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===================== MIDDLE ROW ===================== -->
    <div class="row mb-section">
      <div class="col-md-4">
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Financial Strength</h2>
            <span class="panel-badge">72/100</span>
          </div>
          <div class="table-wrapper" id="financial-table"></div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Rate Benchmarking</h2>
            <span class="panel-badge">65/100</span>
          </div>
          <div class="table-wrapper" id="rate-table"></div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Provider Quality</h2>
            <span class="panel-badge">87/100</span>
          </div>
          <div class="chart-container">
            <div id="quality-plot" style="width: 100%; height: 100%;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===================== SCENARIO & GOALS ===================== -->
    <div class="row">
      <div class="col-lg-9">
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Scenario Planner</h2>
            <span class="panel-badge">What-If Analysis</span>
          </div>
          <div class="scenario-wrapper">
            <div class="scenario-controls">
              <div class="scenario-title">Configure Scenario</div>
              
              <div>
                <label class="form-label">Specialty</label>
                <select id="scenario-specialty" class="form-select form-select-sm">
                  <option>Cardiology</option>
                  <option>Orthopedics</option>
                  <option>Radiology</option>
                  <option>Primary Care</option>
                </select>
              </div>
              
              <div>
                <label class="form-label">Rate Change (%)</label>
                <input id="scenario-slider" type="range" min="-10" max="10" value="-6" class="form-range">
                <div class="slider-value" id="slider-value">-6%</div>
              </div>
            </div>

            <div class="scenario-results" id="scenario-result"></div>
          </div>
        </div>
      </div>

      <div class="col-lg-3">
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Strategic Goals</h2>
          </div>
          
          <div style="margin-bottom: 28px;">
            <div class="metric-label">Cost Reduction</div>
            <div class="metric-value" style="font-size: 20px;">$9.2M / $15M</div>
            <div class="progress">
              <div class="progress-bar" style="width:61%"></div>
            </div>
            <div class="metric-trend">61% Complete</div>
          </div>
          
          <div>
            <div class="metric-label">CMS Adequacy</div>
            <div class="metric-value" style="font-size: 20px;">92%</div>
            <div class="progress">
              <div class="progress-bar" style="width:92%"></div>
            </div>
            <div class="metric-trend">Target: 95%</div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      Prototype Dashboard (Synthetic Data) — HiLabs 2025 • No PHI • Confidential
    </div>
  </div>

  <!-- ===================== LIBRARIES ===================== -->
  <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.24.0/plotly.min.js"></script>

  <script>
    // ===================== DATA =====================
    const regionData = {
      "Southwest": { states:[
        {s:"AZ", n:"Arizona", v:9, impact:85, save:2.1, adequacy:91},
        {s:"NM", n:"New Mexico", v:7, impact:42, save:0.9, adequacy:89},
        {s:"NV", n:"Nevada", v:11, impact:58, save:1.8, adequacy:86}
      ]},
      "New England": { states:[
        {s:"MA", n:"Massachusetts", v:8, impact:95, save:2.4, adequacy:95},
        {s:"CT", n:"Connecticut", v:10, impact:62, save:1.6, adequacy:92},
        {s:"RI", n:"Rhode Island", v:6, impact:28, save:0.7, adequacy:90},
        {s:"NH", n:"New Hampshire", v:5, impact:35, save:0.9, adequacy:94}
      ]},
      "Pacific Northwest": { states:[
        {s:"WA", n:"Washington", v:7, impact:78, save:1.9, adequacy:88},
        {s:"OR", n:"Oregon", v:9, impact:55, save:1.4, adequacy:91},
        {s:"CA", n:"Northern California", v:12, impact:125, save:3.2, adequacy:83}
      ]},
      "Great Lakes": { states:[
        {s:"IL", n:"Illinois", v:10, impact:105, save:2.8, adequacy:88},
        {s:"MI", n:"Michigan", v:8, impact:72, save:1.8, adequacy:91},
        {s:"OH", n:"Ohio", v:9, impact:88, save:2.2, adequacy:90}
      ]},
      "Southeast": { states:[
        {s:"FL", n:"Florida", v:11, impact:145, save:3.8, adequacy:82},
        {s:"GA", n:"Georgia", v:8, impact:82, save:2.0, adequacy:90},
        {s:"SC", n:"South Carolina", v:7, impact:48, save:1.2, adequacy:92}
      ]},
      "Mountain States": { states:[
        {s:"CO", n:"Colorado", v:9, impact:92, save:2.3, adequacy:89},
        {s:"UT", n:"Utah", v:6, impact:45, save:1.1, adequacy:93},
        {s:"ID", n:"Idaho", v:5, impact:32, save:0.8, adequacy:96}
      ]}
    };

    const networkMetrics = {
      "Great Plains Care Connect": {spend:280, leakage:15.2, pos:"+8.1%"},
      "PacificCare Integrated Health": {spend:420, leakage:22.4, pos:"+10.5%"},
      "Midwest Regional Medical": {spend:310, leakage:13.6, pos:"+5.8%"},
      "Tri-State Wellness": {spend:245, leakage:12.3, pos:"+6.2%"},
      "Northeast Community Health": {spend:360, leakage:18.0, pos:"+9.0%"},
      "Southern Cross Healthcare": {spend:200, leakage:9.8, pos:"+4.2%"},
      "Bayview Specialty Health": {spend:150, leakage:7.4, pos:"+3.6%"},
      "Rocky Mountain Health": {spend:95, leakage:4.5, pos:"+2.0%"}
    };

    const financialRows = [
      {m:"Net Network Revenue", v:"$3.123B", p:"99th", s:"Excellent"},
      {m:"Avg Provider Margins", v:"-5.1%", p:"31st", s:"Below Avg"},
      {m:"Net Operating Profit", v:"11.8%", p:"6th", s:"Poor"},
      {m:"Days Outstanding", v:"39.1", p:"72nd", s:"Average"},
      {m:"Network Savings ID'd", v:"$12.3M", p:"68th", s:"Above Avg"}
    ];

    const rateRows = [
      {sp:"Cardiology (Office)", cur:420, med:390, pct:75, st:"OVERPAYING", sav:"$150K"},
      {sp:"Orthopedics", cur:380, med:350, pct:80, st:"OVERPAYING", sav:"$120K"},
      {sp:"Primary Care", cur:185, med:175, pct:60, st:"MODERATE", sav:"$95K"},
      {sp:"Radiology (MRI)", cur:520, med:475, pct:82, st:"OVERPAYING", sav:"$180K"},
      {sp:"General Surgery", cur:680, med:620, pct:77, st:"OVERPAYING", sav:"$140K"}
    ];

    // ===================== HELPER FUNCTIONS =====================
    function getSeverityClass(v) {
      if (v > 10) return 'severity-high';
      if (v > 5) return 'severity-medium';
      return 'severity-low';
    }

    // ===================== HEATMAP RENDERING =====================
    function renderHeatmap(regionKey) {
      const data = regionData[regionKey];
      if (!data) return;

      const container = document.getElementById('heatmap-grid');
      container.innerHTML = '';

      data.states.forEach(state => {
        const cell = document.createElement('div');
        cell.className = `heatmap-cell ${getSeverityClass(state.v)}`;
        cell.innerHTML = `
          <div class="heatmap-state">${state.n}</div>
          <div class="heatmap-value">${state.v}%</div>
          <div class="heatmap-label">Overpayment</div>
          <div class="heatmap-details">
            <div>Impact: $${state.impact}M</div>
            <div>Savings: $${state.save}M</div>
            <div>Adequacy: ${state.adequacy}%</div>
          </div>
        `;
        
        cell.addEventListener('click', () => {
          showContextualSuggestions(state, regionKey);
          document.getElementById('ai-suggestions').scrollIntoView({behavior:'smooth'});
        });
        
        container.appendChild(cell);
      });
    }

    // ===================== NETWORK UPDATES =====================
    document.getElementById('network-name').addEventListener('change', function(e) {
      const key = e.target.value;
      const m = networkMetrics[key] || networkMetrics["Bayview Specialty Health"];
      document.getElementById('total-spend').innerText = `$${m.spend}M`;
      document.getElementById('cost-leakage').innerText = `$${m.leakage}M`;
      document.getElementById('market-position').innerText = m.pos;
      document.getElementById('provider-count').innerText = Math.round(m.spend * 3.2);
      document.getElementById('savings-opp').innerText = `${Math.round(m.leakage/0.8)} contracts (~$${m.leakage.toFixed(1)}M)`;
      document.getElementById('rate-score').innerText = `${Math.max(5,(10 - m.leakage/2)).toFixed(1)} / 10`;
      document.getElementById('adequacy').innerText = `${Math.max(85, 95 - Math.round(m.leakage/3))}%`;
      runQuickScan();
    });

    document.getElementById('coverage-area').addEventListener('change', e => {
      renderHeatmap(e.target.value);
      runQuickScan();
    });

    // ===================== RENDER TABLES =====================
    function renderFinancial() {
      const el = document.getElementById('financial-table');
      let html = '<table class="table table-sm"><thead><tr><th>Metric</th><th>Value</th><th>Percentile</th><th>Status</th></tr></thead><tbody>';
      financialRows.forEach(r => html += `<tr><td>${r.m}</td><td>${r.v}</td><td>${r.p}</td><td>${r.s}</td></tr>`);
      html += '</tbody></table>';
      el.innerHTML = html;
    }

    function renderRateTable() {
      const el = document.getElementById('rate-table');
      let html = '<table class="table table-sm"><thead><tr><th>Specialty</th><th>Current</th><th>Median</th><th>%ile</th><th>Status</th><th>Savings</th></tr></thead><tbody>';
      rateRows.forEach(r => html += `<tr><td>${r.sp}</td><td>$${r.cur}</td><td>$${r.med}</td><td>${r.pct}</td><td>${r.st}</td><td>${r.sav}</td></tr>`);
      html += '</tbody></table>';
      el.innerHTML = html;
    }

    function renderQuality() {
      const rows = [
        {x:90,y:15,label:"Ortho Surgery Center"},
        {x:75,y:85,label:"North Cardiology"},
        {x:82,y:72,label:"Metro Radiology"},
        {x:60,y:78,label:"Community PCP"},
        {x:50,y:49,label:"Rural Health Center"}
      ];
      
      const data = [{
        x: rows.map(r=>r.x),
        y: rows.map(r=>r.y),
        text: rows.map(r=>r.label),
        mode: 'markers',
        marker: {
          size: 14,
          color: rows.map(r=> r.y>=80 ? '#2c6aef':'#f59e0b'),
          line: { width: 2, color: '#fff' }
        }
      }];
      
      const layout = {
        margin: {t:20,l:50,r:20,b:50},
        xaxis: {title:'Cost Percentile', gridcolor:'#f3f4f6'},
        yaxis: {title:'Quality Percentile', gridcolor:'#f3f4f6'},
        hovermode: 'closest',
        plot_bgcolor: 'rgba(0,0,0,0)',
        paper_bgcolor: 'rgba(0,0,0,0)'
      };
      
      Plotly.newPlot('quality-plot', data, layout, {displayModeBar:false, responsive:true});
    }

    // ===================== SCENARIO LOGIC =====================
    const slider = document.getElementById('scenario-slider');
    const sliderValue = document.getElementById('slider-value');
    const scenarioResult = document.getElementById('scenario-result');

    function updateScenario() {
      const cut = Number(slider.value);
      sliderValue.innerText = (cut>0?'+':'') + cut + '%';
      const specialty = document.getElementById('scenario-specialty').value;
      const baseM = 150;
      const savings = Math.round(Math.abs(cut) * 1.3 * 100)/100;
      const exitRisk = Math.min(100, Math.round(Math.abs(cut)*3 + 2));
      const adequacyAfter = Math.max(78, 92 - Math.round(Math.max(0, (Math.abs(cut)-3)*1.5)));

      scenarioResult.innerHTML = `
        <div style="font-weight:700; margin-bottom:16px; font-size:16px; color: var(--text-primary);">
          Impact Analysis: ${specialty}
        </div>
        <table class="table table-sm">
          <thead>
            <tr><th>Metric</th><th>Before</th><th>After</th></tr>
          </thead>
          <tbody>
            <tr><td>Total Spend</td><td>$${baseM}M</td><td>$${(baseM - savings).toFixed(2)}M</td></tr>
            <tr><td>Projected Savings</td><td>—</td><td><strong style="color: var(--success)">$${savings}M</strong></td></tr>
            <tr><td>Provider Exit Risk</td><td>—</td><td><strong style="color: ${exitRisk > 20 ? 'var(--danger)' : 'var(--warning)'}">${exitRisk}%</strong></td></tr>
            <tr><td>Network Adequacy</td><td>92%</td><td><strong>${adequacyAfter}%</strong></td></tr>
          </tbody>
        </table>
        <div class="alert alert-info" style="margin-top:16px;">
          <strong>Recommendation:</strong> ${Math.abs(cut) > 6 ? 'Consider smaller rate cut (4-5%) or recruit new providers to maintain adequacy.' : 'This change appears manageable. Monitor provider feedback closely.'}
        </div>
      `;
    }

    slider.addEventListener('input', updateScenario);
    document.getElementById('scenario-specialty').addEventListener('change', updateScenario);

    // ===================== AI SUGGESTIONS =====================
    const aiContainer = document.getElementById('ai-suggestions');

    function clearAISuggestions() {
      aiContainer.innerHTML = '';
    }

    function addSuggestion(title, body, confidence) {
      const el = document.createElement('div');
      el.className = 'ai-suggestion';
      el.innerHTML = `
        <div class="ai-suggestion-title">
          ${title}
          <span class="confidence-badge">${Math.round(confidence*100)}%</span>
        </div>
        <div class="ai-suggestion-body">${body}</div>
      `;
      aiContainer.appendChild(el);
    }

    function showContextualSuggestions(stateObj, regionKey) {
      clearAISuggestions();
      const v = stateObj.v;
      const impact = stateObj.impact;
      const adequacy = stateObj.adequacy || 92;

      if (v > 10 && impact > 50) {
        addSuggestion(
          `High Priority: ${stateObj.n}`,
          `State shows ${v}% overpayment with $${impact}M impact. Run targeted RFPs for top 3 specialties and prioritize contract renegotiation with highest-spend providers.`,
          0.92
        );
      } else if (v > 8) {
        addSuggestion(
          `Monitor: ${stateObj.n}`,
          `Overpayment ${v}%. Start clinical & coding audit for top 5 facilities. Consider mild rate reductions with provider incentives.`,
          0.78
        );
      } else {
        addSuggestion(
          `Low Risk: ${stateObj.n}`,
          `Overpayment ${v}%. Maintain monitoring cadence and focus on access/adequacy improvement if needed.`,
          0.65
        );
      }

      if (adequacy < 90) {
        addSuggestion(
          `Adequacy Risk: Recruit PCPs`,
          `Adequacy ${adequacy}% in ${stateObj.n}. Suggest shortlisting 2-4 high-value PCP practices for targeted contracting with onboarding incentives.`,
          0.85
        );
      }

      addSuggestion(
        `Next Steps`,
        `1) Add ${stateObj.n} to "High Priority" watchlist. 2) Launch provider-level cost drilldown. 3) Prepare stakeholder memo. Use 'Export' to download as CSV.`,
        0.76
      );
    }

    function runQuickScan() {
      clearAISuggestions();
      const areaKey = document.getElementById('coverage-area').value;
      const area = regionData[areaKey];
      if (!area) {
        addSuggestion('No Data','No region selected or data unavailable.',0.35);
        return;
      }

      const ranked = area.states.map(s => ({...s, score: s.v * s.impact})).sort((a,b)=>b.score - a.score);
      const top = ranked.slice(0,3);

      addSuggestion(
        `Top Priorities in ${areaKey}`,
        `Found ${area.states.length} states. Top priority: ${top[0].n} (risk score ${Math.round(top[0].score)}). See targeted actions below.`,
        0.88
      );

      top.forEach((t, idx) => {
        const conf = Math.min(0.95, Math.max(0.6, t.score / 200));
        addSuggestion(
          `${idx+1}. ${t.n} — Actionable`,
          `Overpay ${t.v}% with $${t.impact}M impact. Recommended: negotiate cardiology & radiology contracts; run coding audit and prepare targeted RFP.`,
          conf
        );
      });

      const overpaySpecialties = rateRows.filter(r => r.st.includes('OVERPAYING')).map(r=>r.sp);
      if (overpaySpecialties.length) {
        addSuggestion(
          'Specialty Recommendation',
          `Prioritize ${overpaySpecialties[0]} for initial RFP based on highest savings per provider (${rateRows[0].sav}).`,
          0.81
        );
      }
    }

    function exportSuggestionsCSV() {
      const items = Array.from(document.querySelectorAll('.ai-suggestion')).map(div => {
        const title = div.querySelector('.ai-suggestion-title').innerText.trim();
        const body = div.querySelector('.ai-suggestion-body').innerText.trim();
        return { title, body };
      });
      
      if (!items.length) {
        alert('No suggestions to export');
        return;
      }
      
      const header = 'Title,Description\n';
      const rows = items.map(i => `"${i.title.replace(/"/g,'""')}","${i.body.replace(/"/g,'""')}"`).join('\n');
      const csv = header + rows;
      const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'hiview_insights_' + new Date().toISOString().split('T')[0] + '.csv';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function askAIQuestion(q) {
      const ql = q.toLowerCase();
      const areaKey = document.getElementById('coverage-area').value;
      const area = regionData[areaKey];
      
      if (ql.includes('which specialty') || ql.includes('specialty to target')) {
        const overpay = rateRows.filter(r=>r.st.includes('OVERPAYING')).slice(0,1).map(r=>r.sp).join(', ');
        return `Based on current benchmarking, start with ${overpay}. Run targeted RFP for that specialty and prioritize high-volume providers. Confidence: 78%`;
      }
      
      if (ql.includes('biggest risk')) {
        const ranked = area.states.map(s => ({...s, score: s.v * s.impact})).sort((a,b)=>b.score - a.score);
        const top = ranked[0];
        return `Biggest regional risk: ${top.n} — ${top.v}% overpay and $${top.impact}M impact. Action: prioritize contract negotiation and adequacy protections. Confidence: 88%`;
      }
      
      if (ql.includes('leakage') || ql.includes('reduce')) {
        return `Start with: 1) specialty-targeted RFPs, 2) coding audits in top overpay states, 3) selective rate reductions with quality incentives. Consider pilot in 1 state first. Confidence: 80%`;
      }
      
      return `I can provide recommendations like "top states to target", "specialties to RFP", or "adequacy actions". Try asking "Which specialty to target first?" or "What's the biggest risk?"`;
    }

    // ===================== EVENT LISTENERS =====================
    document.getElementById('run-scan').addEventListener('click', runQuickScan);
    document.getElementById('export-suggestions').addEventListener('click', exportSuggestionsCSV);
    document.getElementById('ai-ask').addEventListener('click', () => {
      const q = document.getElementById('ai-question').value || '';
      const answerEl = document.getElementById('ai-answer');
      
      if (!q) {
        answerEl.innerText = 'Please type a question.';
        return;
      }
      
      answerEl.innerText = 'Analyzing...';
      setTimeout(() => {
        answerEl.innerText = askAIQuestion(q);
      }, 400);
    });

    // ===================== INITIALIZE =====================
    renderHeatmap("Great Lakes");
    renderFinancial();
    renderRateTable();
    renderQuality();
    updateScenario();
    runQuickScan();
  </script>
</body>
</html>
